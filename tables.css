/* tables.css — generator panels (match Skazka theme) */

:root {
  /* Uses your global vars from styles.css; fallback here for safety */
  --sb-panel: var(--sb-panel, #12131a);
  --sb-panel2: var(--sb-panel2, #171922);
  --sb-border: var(--sb-border, #2a2d36);
  --sb-text: var(--sb-text, #e6dccb);
  --sb-dim: var(--sb-dim, #b9b09e);
  --sb-gold: var(--sb-gold, #c2a13a);
  --sb-gold-strong: var(--sb-gold-strong, #e1b84d);
  --sb-radius: var(--sb-radius, 14px);
}

/* Panel */
.tb-panel {
  display: grid;
  gap: 12px;
  background: linear-gradient(180deg, var(--sb-panel), var(--sb-panel2));
  border: 1px solid var(--sb-border);
  border-radius: var(--sb-radius);
  padding: clamp(12px, 2vw, 18px);
  color: var(--sb-text);
  box-shadow: 0 12px 24px rgba(0, 0, 0, .45), inset 0 1px 0 rgba(255, 255, 255, .02);
  margin: 18px 0;
  font-size: 1.1rem;
}

.tb-title {
  margin: 0 0 10px;
  color: var(--sb-gold-strong);
  letter-spacing: .3px;
  font-weight: 900;
}

/* Grid for controls */
.tb-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 10px;
  align-items: end;
}

.tb-label {
  display: flex;
  flex-direction: column;
  gap: 6px;
  font-weight: 800;
  letter-spacing: .2px;
}

/* Inputs/selects/buttons */
.tb-input,
.tb-select {
  width: 100%;
  background: #0f1117;
  color: var(--sb-text);
  border: 1px solid var(--sb-border);
  border-radius: 10px;
  padding: 10px 12px;
  min-height: 42px;
  outline: none;
}

.tb-input:focus,
.tb-select:focus {
  border-color: var(--sb-gold-strong);
  box-shadow: 0 0 0 2px rgba(226, 184, 77, .25);
  background: #10131a;
}

.tb-actions {
  display: flex;
  margin-top: 8px;
  gap: 8px;
  flex-wrap: wrap;
}

.tb-btn {
  background: linear-gradient(180deg, var(--sb-gold-strong), var(--sb-gold));
  color: #0b0a07;
  border: 1px solid color-mix(in oklab, var(--sb-gold) 70%, black);
  margin-top: 4px;
  border-radius: 10px;
  padding: 10px 14px;
  font-weight: 700;
  cursor: pointer;
  transition: transform .06s ease, box-shadow .2s ease, filter .2s ease;
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.15);
}

.tb-btn:hover {
  filter: brightness(1.05);
  box-shadow: 0 0 0 2px rgba(226, 184, 77, .25), 0 10px 24px rgba(226, 184, 77, .25);
}

.tb-btn:active {
  transform: translateY(1px);
}

.tb-ghost-btn {
  background: transparent;
  color: var(--sb-gold-strong);
  border: 1px solid var(--sb-gold);
  border-radius: 10px;
  padding: 10px 14px;
  cursor: pointer;
  transition: background .2s ease, box-shadow .2s ease;
}

.tb-ghost-btn:hover {
  background: rgba(226, 184, 77, .08);
  box-shadow: inset 0 0 0 1px rgba(226, 184, 77, .18);
}

/* Result */
.tb-result {
  display: block;
  margin-top: 10px;
  padding: 10px 12px;
  border: 1px dashed var(--sb-border);
  border-radius: 10px;
  color: var(--sb-text);
  background: rgba(0, 0, 0, .14);
  white-space: pre-wrap;
  line-height: 1.55;
}

/* Traps: render multi-line nicely, with a bold label and readable spacing */
#trapResult {
  white-space: normal;
}

/* allow <div> lines to wrap */
#trapResult .tb-line {
  margin: 2px 0;
}

#trapResult .tb-label {
  font-weight: 800;
  margin-right: 4px;
}

/* Divider image consistency on this page */
.divider-image {
  display: block !important;
  width: min(680px, 60%);
  height: auto;
  margin: 0 auto clamp(8px, 2.4vw, 20px);
}

/* Treasure & Quirk results may include HTML lists */
#treasureResult,
#quirkResult {
  white-space: normal;
}

.tb-result ul {
  margin: 6px 0 0 1.1rem;
  padding: 0;
}

.tb-result li {
  margin: 2px 0;
}

.tb-kv {
  margin: 2px 0;
  display: grid;
  grid-template-columns: minmax(12rem, 22rem) 1fr;
  gap: 6px 12px;
}

.tb-kv .k {
  font-weight: 800;
  margin-right: 6px;
}

/* Simple table for shop results */
.tb-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

.tb-table thead th {
  text-align: left;
  color: var(--sb-gold-strong);
  font-weight: 900;
}

.tb-table th,
.tb-table td {
  padding: 6px 8px;
  border-bottom: 1px dashed var(--sb-border);
}

.tb-table td {
  vertical-align: top;
}

.tb-table .tb-badges {
  gap: 6px;
  /* a bit tighter in rows */
  margin-top: 2px;
}

.tb-table .tb-coins {
  margin-top: 2px;
}

.tb-table .tb-detail-name {
  font: inherit;
  /* stop the 1.125rem detail header sizing */
  font-weight: 700;
  line-height: 1.25;
  margin: 0 0 2px;
}

.tb-table tbody tr:last-child td {
  border-bottom: 0;
}

.tb-seg {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.tb-segbtn[aria-pressed="true"] {
  outline: 2px solid var(--sb-gold-strong);
  filter: saturate(1.2) brightness(2);
}

.tb-help {
  opacity: .8;
  font-size: .9rem;
  margin-top: .25rem;
}

.tb-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 8px;
  border-bottom: 1px solid var(--tb-border, #2c2c2c);
}

.tb-row--head {
  font-weight: 600;
  opacity: .8;
  border-bottom: 1px solid var(--tb-border, #2c2c2c);
}

.tb-row.is-selected {
  outline: 1px solid var(--tb-accent, #d4b25e);
  outline-offset: -1px;
}

.tb-detail-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 8px;
  margin-bottom: 2px;
}

.tb-detail-name {
  font-weight: 700;
  font-size: 1.125rem;
  line-height: 1.2;
}

.tb-badges {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.tb-badge {
  font-size: 12px;
  border: 1px solid #666;
  border-radius: 999px;
  padding: 2px 8px;
}

.tb-badge-warn {
  border-color: #b85;
  color: #b85;
}

.tb-kv {
  display: grid;
  gap: 4px;
}

.tb-kv-row {
  display: contents;
  gap: 8px;
  text-align: right;
  opacity: .7;
}

.tb-kv-key {
  width: 40%;
  opacity: .8;
}

.tb-kv-val {
  white-space: pre-wrap;
}

.tb-coins {
  opacity: .7;
  margin-left: 6px;
  font-size: 12px;
}

.tb-table tbody tr.is-selected {
  filter: brightness(2.0);
}

.tb-table td:nth-child(1) {
  width: 44%;
}

.tb-table td:nth-child(2) {
  width: 26%;
}

.tb-table td:nth-child(3),
.tb-table td:nth-child(4) {
  width: 15%;

}

#shopDetail {
  padding: 0;
}

.tb-detail {

  max-width: 56rem;
  margin-inline: auto;
  display: grid;
  gap: 10px;
}

#shopDetail.tb-result {
  padding: 14px;
  border: 1px solid var(--sb-gold);
  background: #161721;
  border-radius: 12px;
}

#shopDetail .tb-detail {
  display: grid;
  gap: 12px;
}

#shopDetail .tb-detail-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 10px;
  flex-wrap: wrap;
}

#shopDetail .tb-detail-name {
  font-weight: 800;
  font-size: 1.25rem;
  line-height: 1.2;
  margin: 0;
}

.tb-detail-desc {
  margin: 2px 0 6px;
  opacity: .9;
}

#shopDetail .tb-badges {
  display: inline-flex;
  gap: 6px;
  flex-wrap: wrap;
}

#shopDetail .tb-kv {
  display: grid;
  grid-template-columns: minmax(140px, 220px) 1fr;
  column-gap: 16px;
  row-gap: 6px;
  align-items: baseline;
}

#shopDetail .tb-kv-row {
  display: contents;
}

#shopDetail .tb-kv-key {
  color: var(--sb-dim);
  font-weight: 700;
  opacity: .9;
}

#shopDetail .tb-kv-val {
  text-align: left;
  /* looks crisp with short values */
  font-variant-numeric: tabular-nums;
  /* tidy numeric columns */
  white-space: normal;
}

#shopDetail .tb-kv-val .coins {
  display: inline-flex;
  gap: 4px;
  margin-left: 8px;
}

#shopDetail .hr {
  height: 1px;
  margin: 2px 0 6px;
  background: linear-gradient(90deg, transparent, var(--sb-border), transparent);
  border: 0;
}

#shopDetail .tb-detail-desc {
  margin-top: 4px;
  opacity: .94;
  line-height: 1.46;
}


/* ===== SHOP TABLE — 60 / 20 / 20, left-aligned prices with inline coins ===== */
#shopResult {
  display: block;
  padding: 0 !important;
  /* override .tb-result padding */
  margin: 0;
  overflow: auto;
  max-height: var(--shop-max, 360px);
  /* JS will set this to ~5 rows */
  -webkit-overflow-scrolling: touch;
}

#shopResult thead th {
  position: sticky;
  top: 0;
  z-index: 3;
  background: var(--sb-panel, #12131a);
  border-bottom: 1px solid var(--sb-border);
}

#shopResult .tb-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

#shopResult .tb-table thead th,
#shopResult .tb-table td {
  padding: 6px 8px;
  vertical-align: top;
  line-height: 1.25;
  border-bottom: 1px dashed var(--sb-border);
}

#shopResult .tb-table thead th {
  position: sticky;
  top: 0;
  z-index: 3;
  background: var(--sb-panel, #12131a);
  border-bottom: 1px solid var(--sb-border);
  text-align: left;
  color: var(--sb-gold-strong);
  font-weight: 900;
}

/* Column widths (JS colgroup uses 60/20/20) */
#shopResult .tb-table td.col-name {
  width: 60%;
}

#shopResult .tb-table td.col-base {
  width: 20%;
}

#shopResult .tb-table td.col-adjusted {
  width: 20%;
}

/* Prices: LEFT aligned for both columns; use tabular numerals for neat columns */
#shopResult .tb-table td.col-base,
#shopResult .tb-table td.col-adjusted {
  text-align: left;
  white-space: normal;
  font-variant-numeric: tabular-nums;
}

/* Keep "6000 gp" together; coins inline on the same line */
.nowrap {
  white-space: nowrap;
}

#shopResult .tb-table td.col-base .tb-coins,
#shopResult .tb-table td.col-adjusted .tb-coins {
  display: inline-flex;
  /* inline with number */
  align-items: baseline;
  gap: 4px;
  margin-left: 8px;
  /* space after “gp” */
  white-space: normal;
}

/* Name + badges on one line (wrappable) */
#shopResult .tb-table .name-line {
  display: flex;
  gap: 8px;
  align-items: baseline;
  flex-wrap: wrap;
}

#shopResult .tb-table .tb-detail-name {
  font: inherit;
  font-weight: 700;
  line-height: 1.22;
  margin: 0;
}

#shopResult .tb-table .tb-badges {
  display: inline-flex;
  gap: 6px;
  flex-wrap: wrap;
}

/* Last row cleanup */
#shopResult .tb-table tbody tr:last-child td {
  border-bottom: 0;
}


/*shop privacy*/
.tb-privacy {
  display: inline-flex;
  align-items: center;
  gap: .5rem;
}

.tb-privacy-label {
  font-size: .9rem;
  opacity: .8;
}

.tb-privacy-status {
  margin-left: .5rem;
  opacity: .75;
}

.tb-privacy-slider {
  width: 72px;
  height: 28px;
  appearance: none;
  background: transparent;
}

/* Track */
.tb-privacy-slider::-webkit-slider-runnable-track {
  height: 28px;
  border-radius: 999px;
  background: linear-gradient(90deg, #3aa655 0 50%, #3aa655 50% 100%);
}

.tb-privacy-slider::-moz-range-track {
  height: 28px;
  border-radius: 999px;
  background: linear-gradient(90deg, #3aa655 0 50%, #3aa655 50% 100%);
}

/* Thumb (knob) */
.tb-privacy-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 26px;
  height: 26px;
  border-radius: 50%;
  background: #fff;
  border: 2px solid rgba(0, 0, 0, .15);
  margin-top: 1px;
  /* center on track */
  box-shadow: 0 1px 2px rgba(0, 0, 0, .2);
}

.tb-privacy-slider::-moz-range-thumb {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  background: #fff;
  border: 2px solid rgba(0, 0, 0, .15);
  box-shadow: 0 1px 2px rgba(0, 0, 0, .2);
}

/* Optional focus ring */
.tb-privacy-slider:focus-visible {
  outline: 2px solid #4a90e2;
  outline-offset: 2px;
}

/* ===========================
   Forge Cheat Sheet — FINAL (tight lists + card/column fixes)
   =========================== */

#forgeSheet.tb-result {
  padding: 8px 10px;
}

/* Overall rhythm */
#forgeSheet .forge {
  display: grid;
  gap: 10px;
  line-height: 1.46;
}

#forgeSheet .forge-section {
  display: grid;
  gap: 4px;
}

/* Headings */
#forgeSheet .forge-h {
  margin: 2px 0 6px !important;
  font-weight: 900;
  color: var(--sb-gold-strong);
  letter-spacing: .2px;
}

/* Body text (never justify) */
#forgeSheet .forge-p,
#forgeSheet p {
  margin: 0;
  opacity: .92;
  text-align: left !important;
  text-justify: auto !important;
}

/* ---------------------------------
   BULLET LISTS — lock spacing tight
   --------------------------------- */
#forgeSheet .forge-list {
  /* Kill any global margins/padding and control spacing via gap */
  margin: 0 !important;
  padding: 0 0 0 1rem !important;
  list-style: disc outside;
  display: grid !important;
  /* force grid so gap applies */
  gap: 4px !important;
  /* tweak here (2–6px) */
}

#forgeSheet .forge-list>li {
  margin: 0 !important;
  padding: 0 !important;
  line-height: 1.46;
  /* match surrounding rhythm */
}

/* Two short paragraphs row */
#forgeSheet .forge-grid-2 {
  display: grid;
  grid-template-columns: 1fr;
  column-gap: 16px;
  row-gap: 8px;
  align-items: start;
}

@media (min-width: 960px) {
  #forgeSheet .forge-grid-2 {
    grid-template-columns: 1fr 1fr;
  }
}

/* Tool cards */
#forgeSheet .forge-tools {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 6px;
}

#forgeSheet .forge-tool {
  flex: 1 1 180px;
  border: 1px solid var(--sb-border);
  border-radius: 12px;
  padding-block: 6px;
  padding-inline: 10px;
  background: color-mix(in oklab, var(--sb-panel2) 85%, black);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .03);
  display: flex;
  flex-direction: column;
  gap: 4px;
}

#forgeSheet .forge-tool-title {
  font-weight: 800;
  margin: 0;
  color: var(--sb-gold-strong);
}

#forgeSheet .forge-tool-desc {
  font-size: .92rem;
  opacity: .88;
  margin: 0;
  text-align: left;
}

/* Table */
#forgeSheet .forge-table {
  width: 100%;
  border-collapse: collapse;
}

#forgeSheet .forge-table thead th {
  font-weight: 900;
}

#forgeSheet .forge-table th,
#forgeSheet .forge-table td {
  padding: 4px 6px;
}

#forgeSheet .forge-table td:first-child,
#forgeSheet .forge-table th:first-child {
  white-space: nowrap;
}

#forgeSheet .forge-table td:nth-child(2),
#forgeSheet .forge-table th:nth-child(2),
#forgeSheet .forge-table td:nth-child(3),
#forgeSheet .forge-table th:nth-child(3) {
  text-align: right;
}

/* Divider */
#forgeSheet .hr {
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--sb-border), transparent);
  margin: 4px 0;
  border: 0;
}

/* --- Generator panel (XGtE) --- */
#forgeSheet .forge-gen {
  border: 1px solid var(--sb-border);
  border-radius: 12px;
  padding: 10px;
  background: color-mix(in oklab, var(--sb-panel2) 85%, black);
  display: grid;
  gap: 8px;
  align-content: start;
}

#forgeSheet .forge-gen-title {
  font-weight: 900;
  color: var(--sb-gold-strong);
  letter-spacing: .2px;
}

#forgeSheet .forge-gen-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

#forgeSheet .forge-chip {
  border: 1px solid var(--sb-gold);
  background: transparent;
  color: var(--sb-gold-strong);
  padding: 6px 10px;
  border-radius: 999px;
  font-weight: 700;
  cursor: pointer;
}

#forgeSheet .forge-chip:hover {
  background: rgba(226, 184, 77, .08);
  box-shadow: inset 0 0 0 1px rgba(226, 184, 77, .18);
}

/* Generated pills output */
#forgeSheet .forge-gen-out {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  min-height: 28px;
}

#forgeSheet .forge-pill {
  border: 1px dashed var(--sb-border);
  border-radius: 999px;
  padding: 4px 8px;
  font-size: .92rem;
  opacity: .95;
}


/* optional: make the options look clickable and ensure it floats over content */
#preset-list {
  z-index: 20;
  box-shadow: 0 6px 18px rgba(0, 0, 0, .35);
}

#preset-list .tb-option:hover,
#preset-list .tb-option:focus {
  outline: none;
  filter: brightness(1.1);
}

/* ============================
   NPC GENERATOR — SCOPED STYLES
   ============================ */

/* Controls row: Occupation + Setting side-by-side; stack on small screens */
#npc-controls {
  display: grid;
  grid-template-columns: repeat(2, minmax(260px, 1fr));
  gap: .6rem;
  align-items: start;
}

@media (max-width: 680px) {
  #npc-controls {
    grid-template-columns: 1fr;
  }
}

/* Combobox + dropdown (scoped) */
#npc-panel .tb-combobox {
  position: relative;
  display: block;
}

#npc-panel .tb-combobox .tb-input {
  padding-right: 36px;
  /* room for the clear button */
}

#npc-panel .tb-input {
  width: 100%;
  display: block;
}

#npc-panel .tb-list {
  position: absolute;
  left: 0;
  right: 0;
  max-height: 240px;
  overflow-y: auto;
  display: none;
  z-index: 20;
  background: #111;
  border: 1px solid rgba(255, 255, 255, .12);
  box-shadow: 0 8px 24px rgba(0, 0, 0, .35);
}

#npc-panel .tb-option {
  padding: .4rem .6rem;
  cursor: pointer;
}

#npc-panel .tb-option:hover,
#npc-panel .tb-option:focus {
  background: rgba(255, 255, 255, .06);
  outline: none;
}

/* Result wrapper itself shouldn’t add big gaps */
#npc-pretty.tb-result {
  margin: 8px 0 0;
  padding: 8px 10px;
}

/* Compact NPC card (scoped to output) */
#npc-pretty .npc-card {
  line-height: 1.28;
  margin: 0;
}

#npc-pretty .npc-card * {
  box-sizing: border-box;
}

/* Nuke default margins that cause tall gaps—only inside the card */
#npc-pretty .npc-card h1,
#npc-pretty .npc-card h2,
#npc-pretty .npc-card h3,
#npc-pretty .npc-card h4,
#npc-pretty .npc-card p,
#npc-pretty .npc-card ul,
#npc-pretty .npc-card li,
#npc-pretty .npc-card blockquote {
  margin: 0;
}

/* Header */
#npc-pretty .npc-header {
  margin-bottom: .22rem;
}

#npc-pretty .npc-name {
  font-weight: 700;
  font-size: 1.06rem;
}

#npc-pretty .npc-tags {
  display: flex;
  flex-wrap: wrap;
  gap: .3rem;
  margin-top: .12rem;
}

#npc-pretty .npc-card .tb-badge {
  padding: .08rem .4rem;
  font-size: .84em;
}

/* Key/Value rows */
#npc-pretty .npc-meta {
  margin: .12rem 0 .24rem;
}

#npc-pretty .npc-meta .row {
  display: grid;
  grid-template-columns: 120px 1fr;
  column-gap: .6rem;
  align-items: baseline;
  padding: .03rem 0;
  /* tight rows */
}

#npc-pretty .npc-meta .k {
  font-weight: 700;
}

/* Hooks */
#npc-pretty .npc-hooks {
  margin: .22rem 0 .18rem;
}

#npc-pretty .npc-hooks h4 {
  font-size: .92rem;
  font-weight: 700;
  margin-bottom: .14rem;
}

#npc-pretty .npc-hooks .hooks {
  list-style: disc;
  padding-left: .9rem;
}

#npc-pretty .npc-hooks .hooks li {
  margin: .06rem 0;
  line-height: 1.28;
}

/* Opener quote */
#npc-pretty .npc-opener {
  margin: .26rem 0 0;
  padding: .32rem .56rem;
  border-left: 2px solid currentColor;
  background: rgba(255, 255, 255, .06);
  border-radius: .32rem;
  opacity: .92;
}

/* NPC panel: neutralize the global .tb-result spacing behavior */
#npc-panel #npc-pretty {
  white-space: normal;
  /* stop preserving template newlines */
  line-height: 1.32;
  /* tighter than the global 1.55 */
  margin-top: 8px;
  padding: 8px 10px;
}

/* Keep the card compact (restates the tight rules, but scoped) */
#npc-panel #npc-pretty .npc-card {
  line-height: 1.28;
}

#npc-panel #npc-pretty .npc-card h1,
#npc-panel #npc-pretty .npc-card h2,
#npc-panel #npc-pretty .npc-card h3,
#npc-panel #npc-pretty .npc-card h4,
#npc-panel #npc-pretty .npc-card p,
#npc-panel #npc-pretty .npc-card ul,
#npc-panel #npc-pretty .npc-card li,
#npc-panel #npc-pretty .npc-card blockquote {
  margin: 0;
}

#npc-panel #npc-pretty .npc-header {
  margin-bottom: .2rem;
}

#npc-panel #npc-pretty .npc-name {
  font-weight: 700;
  font-size: 1.06rem;
}

#npc-panel #npc-pretty .npc-tags {
  display: flex;
  flex-wrap: wrap;
  gap: .3rem;
  margin-top: .12rem;
}

#npc-panel #npc-pretty .npc-card .tb-badge {
  padding: .08rem .4rem;
  font-size: .84em;
}

#npc-panel #npc-pretty .npc-meta {
  margin: .1rem 0 .22rem;
}

#npc-panel #npc-pretty .npc-meta .row {
  display: grid;
  grid-template-columns: 120px 1fr;
  column-gap: .6rem;
  align-items: baseline;
  padding: .02rem 0;
}

#npc-panel #npc-pretty .npc-meta .k {
  font-weight: 700;
}

#npc-panel #npc-pretty .npc-hooks {
  margin: .2rem 0 .16rem;
}

#npc-panel #npc-pretty .npc-hooks h4 {
  font-size: .92rem;
  font-weight: 700;
  margin-bottom: .12rem;
}

#npc-panel #npc-pretty .npc-hooks .hooks {
  list-style: disc;
  padding-left: .9rem;
}

#npc-panel #npc-pretty .npc-hooks .hooks li {
  margin: .05rem 0;
  line-height: 1.28;
}

#npc-panel #npc-pretty .npc-opener {
  margin: .24rem 0 0;
  padding: .3rem .56rem;
  border-left: 2px solid currentColor;
  background: rgba(255, 255, 255, .06);
  border-radius: .32rem;
  opacity: .92;
}

/* Clear (×) button inside inputs */
#npc-panel .tb-combobox .tb-clear {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  /* center vertically */
  height: 22px;
  width: 22px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border: 0;
  border-radius: 6px;
  background: transparent;
  color: var(--sb-dim);
  cursor: pointer;
  z-index: 21;
  /* above the input */
  padding: 0;
  line-height: 1;
}

#npc-panel .tb-combobox .tb-clear:hover {
  background: rgba(255, 255, 255, .08);
  color: var(--sb-text);
}

#npc-panel .tb-combobox .tb-clear:hover,
#npc-panel .tb-combobox .tb-clear:focus-visible {
  background: rgba(255, 255, 255, .08);
  color: var(--sb-text);
  outline: none;
}

/* Safari: ensure button isn't shifted by line-height quirks */
@supports (-webkit-touch-callout: none) {
  #npc-panel .tb-combobox .tb-clear {
    line-height: 1;
  }
}

/* ===========================
   TREASURE — badges & coins
   =========================== */


/* Loot lines: name + badges left, coins right */
.tb-result .loot-line {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 6px 8px;
  margin: 2px 0 2px 10px;
  line-height: 1.45;
  white-space: normal;
}

.tb-result .loot-line .tb-badges {
  display: inline-flex;
  /* ensure flex item for ordering */
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  order: 2;
}

.tb-result .loot-line .coins {
  order: 3;
  margin-left: auto;
}

/* Badges */
.tb-badges {
  display: inline-flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: center;
}

.tb-badge {
  font-size: 14px;
  line-height: 1.15;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid color-mix(in oklab, var(--sb-border) 80%, #000);
  background: color-mix(in oklab, var(--sb-panel2) 85%, #000);
  color: var(--sb-dim);
  text-transform: none;
}

.tb-badge-warn {
  border-color: #b85;
  color: #b85;
}

/* Rarity tints
   NOTE: we support “very rare”, “very_rare”, and “very-rare”. */
.tb-badge.rarity.common {
  color: #cfd3da;
  border-color: #6b707c;
}

.tb-badge.rarity.uncommon {
  color: #4cc98a;
  border-color: #2c8a5f;
}

.tb-badge.rarity.rare {
  color: #5aa8ff;
  border-color: #3c6fb8;
}

/* all spellings for very rare */
.tb-badge.rarity.very.rare,
.tb-badge.rarity.very_rare,
.tb-badge.rarity.very-rare {
  color: #b888ff;
  border-color: #7a58c9;
}

.tb-badge.rarity.legendary {
  color: #ffb24d;
  border-color: #bf7a1f;
}

.tb-badge.rarity.artifact {
  color: #ff6b6b;
  border-color: #b53f3f;
}

/* Attunement / Slot / Consumable */
.tb-badge.attune.attune-true {
  color: #ffd86b;
  border-color: #b38b2c;
}

.tb-badge.attune.attune-false {
  color: #9bb2c9;
  border-color: #546476;
}

.tb-badge.slot {
  color: #d8d2c2;
  border-color: #6b6659;
}

.tb-badge.consumable {
  color: #8bd16a;
  border-color: #3f7a2a;
}

/* Coin chips */
:root {
  --coin-pp: #b8e3ff;
  /* platinum */
  --coin-gp: var(--sb-gold-strong, #e1b84d);
  /* gold     */
  --coin-sp: #c9c9d6;
  /* silver   */
  --coin-cp: #c88a55;
  /* copper   */
}

.coins {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  margin-left: 6px;
  font-size: 16px;
  opacity: .95;
  font-variant-numeric: tabular-nums;
  /* nicer digit alignment */
}

.coin {
  display: inline-flex;
  align-items: center;
  padding: 1px 6px;
  border-radius: 999px;
  border: 1px solid var(--sb-border);
  background: color-mix(in oklab, var(--sb-panel2) 78%, #000);
  line-height: 1.2;
  letter-spacing: .1px;
}

.coin-pp {
  color: var(--coin-pp);
  border-color: color-mix(in oklab, var(--coin-pp) 50%, #000);
}

.coin-gp {
  color: var(--coin-gp);
  border-color: color-mix(in oklab, var(--coin-gp) 55%, #000);
}

.coin-sp {
  color: var(--coin-sp);
  border-color: color-mix(in oklab, var(--coin-sp) 45%, #000);
}

.coin-cp {
  color: var(--coin-cp);
  border-color: color-mix(in oklab, var(--coin-cp) 45%, #000);
}

/* Subtle difference for sell vs price rows */
.coins-price .coin {
  opacity: .95;
}

.coins-sell .coin {
  opacity: .85;
  filter: saturate(.9);
}

/* Tighten on very small screens */
@media (max-width:560px) {
  .tb-result .loot-line .coins {
    margin-top: 2px;
  }
}

/* ===========================
   SHOP — 3-column controls layout
   =========================== */
.shop-controls {
  display: grid;
  grid-template-columns: minmax(280px, 1fr) minmax(280px, 1fr) minmax(160px, auto);
  gap: 16px 24px;
  align-items: start;
  margin-bottom: 8px;
}

.shop-controls .col-1,
.shop-controls .col-2 {
  display: grid;
  gap: 10px;
}

.shop-controls .haggle-block {
  display: grid;
  gap: 8px;
}

.shop-controls .col-3 {
  grid-column: 3;
  align-self: end;
  /* bottom of controls area */
  justify-self: end;
  /* right edge */
}

.tb-coins-toggle {
  display: inline-flex;
  flex-direction: row;
  /* force same line */
  align-items: center;
  gap: 8px;
  white-space: nowrap;

  /* bottom-right placement */
  margin: 0 0 0 auto;
  /* push to the right in flex parents */
  justify-self: end;
  /* right in grid cell */
  align-self: end;
  /* bottom in grid cell */
}

.tb-coins-toggle input {
  margin: 0;
}

/* Responsive collapse */
@media (max-width: 1100px) {
  .shop-controls {
    grid-template-columns: 1fr;
  }

  .shop-controls .col-3 {
    align-self: start;
    justify-self: start;
    margin-top: 4px;
  }
}

/* Publication badge */
.tb-badge.pub {
  /* same base styling as .tb-badge; only colors differ per type */
  border-color: color-mix(in oklab, var(--sb-border) 80%, #000);
  color: var(--sb-dim);
}

/* ============================================================================
   BADGE PALETTE — unified scheme
   - Text & border always share the same color
   - “Solid” badges: colored background with white (or chosen) text/border
   - “Outline” badges (rarities): transparent background, colored text/border
   ============================================================================ */

/* --- Palette (tweak here if you want different shades) --- */
:root {
  --badge-white: #ffffff;
  --badge-grey: #9aa3ae;
  --badge-green: #8bd16a;
  /* light green */
  --badge-blue: #5aa8ff;
  /* bright blue */
  --badge-orange: #ffb24d;
  --badge-purple: #b888ff;

  --badge-navy: #0f2a5f;
  /* publication text/border on white */
  --slot-blue: #2b6cb0;
  /* solid slot background */
  --danger-red: #d64545;
  /* cursed / attune-false text */
  --ok-green: #2e8b57;
  /* attune-true text on white */
  --solid-purple: #6b3fb8;
  /* vestige bg */
  --solid-gold: #9c7b2d;
  /* tattoo bg */
  --solid-teal: #2c8a5f;
  /* focus bg */
  --solid-slate: #374151;
  /* charges bg */
}

/* ----------------------------------------------------------------------------
   RARITIES (outline: transparent bg, colored text + border)
   ---------------------------------------------------------------------------- */
.tb-badge.rarity.common {
  color: var(--badge-white);
  border-color: var(--badge-white);
}

.tb-badge.rarity.uncommon {
  color: var(--badge-grey);
  border-color: var(--badge-grey);
}

.tb-badge.rarity.rare {
  color: var(--badge-green);
  border-color: var(--badge-green);
}

.tb-badge.rarity.very.rare,
.tb-badge.rarity.very_rare,
.tb-badge.rarity.very-rare {
  color: var(--badge-blue);
  border-color: var(--badge-blue);
}

.tb-badge.rarity.legendary {
  color: var(--badge-orange);
  border-color: var(--badge-orange);
}

.tb-badge.rarity.artifact {
  color: var(--badge-purple);
  border-color: var(--badge-purple);
}

/* ----------------------------------------------------------------------------
   PUBLICATION (all the same: white bg, navy text + border)
   Data values: srd | wotc_exp | 3rd party | homebrew
   We also support legacy class names via aliases.
   ---------------------------------------------------------------------------- */
.tb-badge.pub[class*="pub-"] {
  background: var(--badge-white);
  color: var(--badge-navy);
  border-color: var(--badge-navy);
}



/* ----------------------------------------------------------------------------
   ATTUNEMENT
   ---------------------------------------------------------------------------- */
.tb-badge.attune.attune-true {
  background: var(--badge-white);
  color: var(--ok-green);
  border-color: var(--ok-green);
}

.tb-badge.attune.attune-false {
  background: var(--badge-white);
  color: var(--danger-red);
  border-color: var(--danger-red);
}

/* ----------------------------------------------------------------------------
   SLOT (solid blue with white text)
   ---------------------------------------------------------------------------- */
.tb-badge.slot {
  background: var(--slot-blue);
  color: var(--badge-white);
  border-color: var(--badge-white);
}

/* ----------------------------------------------------------------------------
   CONSUMABLE (keep as a solid supportive green)
   ---------------------------------------------------------------------------- */
.tb-badge.consumable {
  background: var(--solid-teal);
  color: var(--badge-white);
  border-color: var(--badge-white);
}

/* ----------------------------------------------------------------------------
   NEW BADGES
   ---------------------------------------------------------------------------- */
/* Vestige: solid purple, white text */
.tb-badge.vestige {
  background: var(--solid-purple);
  color: var(--badge-white);
  border-color: var(--badge-white);
}

/* Cursed: solid red, white text */
.tb-badge.cursed {
  background: var(--danger-red);
  color: var(--badge-white);
  border-color: var(--badge-white);
}

/* Sentient: solid white, purple text */
.tb-badge.sentient {
  background: var(--badge-white);
  color: var(--solid-purple);
  border-color: var(--solid-purple);
}

/* Charges: solid slate, white text (neutral utility) */
.tb-badge.charges {
  background: var(--solid-slate);
  color: var(--badge-white);
  border-color: var(--badge-white);
}

/* Tattoo: solid gold, white text (distinctive) */
.tb-badge.tattoo {
  background: var(--solid-gold);
  color: var(--badge-white);
  border-color: var(--badge-white);
}

/* Focus: solid teal, white text (supportive) */
.tb-badge.focus {
  background: var(--solid-teal);
  color: var(--badge-white);
  border-color: var(--badge-white);
}

.tb-detail .tb-badges {
  display: block;
  /* badges are inline-block; block parent is fine */
  white-space: nowrap;
  /* no wrap */
  overflow-x: auto;
  /* scroll if too many */
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;
}

.tb-detail .tb-badge {
  display: inline-block;
}
<!-- navbar.html (updated, drop-in) -->
<nav class="navbar">
  <style>
    :root {
      --sb-bg: #0a0b0f;
      --sb-panel: #12131a;
      --sb-panel2: #171922;
      --sb-border: #2a2d36;
      --sb-text: #e6dccb;
      --sb-dim: #b9b09e;
      --sb-gold: #c2a13a;
      --sb-gold-strong: #e1b84d;
      --sb-chip: #20222b;
      --sb-radius: 14px;
      --sb-gap: 10px;
      --sb-rune: rgb(205, 248, 255);

      /* Desktop submenu sizing */
      --menu-w: 210px;
      --submenu-font: 1.1rem;
      --submenu-pad-y: 8px;
      --submenu-pad-x: 12px;
    }

    .navbar {
      position: fixed;
      top: 0;
      width: 100%;
      background: var(--sb-panel2);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 25px;
      height: 80px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, .35);
      border-bottom: 1px solid var(--sb-border);
      z-index: 1000;
    }

    .logo img {
      height: 80px;
    }

    .nav-links {
      list-style: none;
      display: flex;
      flex: 1;
      justify-content: center;
      align-items: center;
      margin: 0;
      z-index: 1100;
    }

    .nav-links>li {
      position: relative;
      list-style: none;
    }

    .nav-links>li>a,
    .nav-links>li>button {
      color: var(--sb-dim);
      text-decoration: none;
      font-size: 1.2rem;
      padding: 0 5px;
      line-height: 80px;
      display: flex;
      align-items: center;
      transition: color .3s, background .2s;
      margin: 0 10px;
      border-radius: 8px;
      background: none;
      border: 0;
      cursor: pointer;
      font: inherit;
    }

    .nav-links>li>a:hover,
    .nav-links>li>button:hover {
      color: var(--sb-gold-strong);
      font-weight: bolder;
    }

    /* Level-1 dropdown panel (base) */
    .dropdown-content {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      width: var(--menu-w);
      background: var(--sb-border);
      border: 1px solid var(--sb-border);
      border-radius: 0 0 10px 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
      z-index: 1200;
      padding: 6px 0;
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    /* Keyboard support */
    .dropdown:focus-within>.dropdown-content {
      display: block;
    }

    /* Each row anchors its flyout */
    .dropdown-content li {
      list-style: none;
      position: relative;
    }

    /* Links & buttons inside dropdowns */
    .dropdown-content a,
    .dropdown-content button,
    .dropdown-submenu a,
    .dropdown-submenu button {
      display: block;
      color: var(--sb-dim);
      text-decoration: none;
      font-size: var(--submenu-font);
      line-height: 1;
      padding: var(--submenu-pad-y) var(--submenu-pad-x);
      margin: 0;
      border-radius: 0;
      white-space: nowrap;
      background: none;
      border: 0;
      cursor: pointer;
      text-align: left;
      font: inherit;
    }

    .dropdown-content a:hover,
    .dropdown-content button:hover,
    .dropdown-submenu a:hover,
    .dropdown-submenu button:hover {
      color: var(--sb-gold-strong);
      background-color: var(--sb-chip);
      font-weight: bolder;
    }

    /* Level-2 flyout */
    .dropdown-submenu {
      display: none;
      position: absolute;
      top: 0;
      left: calc(100% - 1px);
      width: var(--menu-w);
      background: var(--sb-border);
      border: 1px solid var(--sb-border);
      border-radius: 0 10px 10px 0;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
      z-index: 1300;
    }

    .dropdown-content li.dropdown:hover>.dropdown-submenu {
      display: block;
    }

    .dropdown-content li.dropdown:focus-within>.dropdown-submenu {
      display: block;
    }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    button.donate {
      background: var(--sb-gold);
      color: #1a1208;
      border: 1px solid rgba(0, 0, 0, .15);
      height: 40px;
      padding: 0 15px;
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    button.donate:hover {
      background: var(--sb-gold-strong);
    }

    /* Hamburger (no inline onclick) */
    .hamburger {
      display: none;
      flex-direction: column;
      justify-content: center;
      width: 30px;
      height: 25px;
      cursor: pointer;
      position: relative;
      z-index: 1400;
      pointer-events: auto;
    }

    .hamburger span {
      height: 4px;
      width: 100%;
      background: var(--sb-text);
      margin: 3px 0;
      border-radius: 2px;
      transition: .3s;
    }

    .hamburger.open span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .hamburger.open span:nth-child(2) {
      opacity: 0;
    }

    .hamburger.open span:nth-child(3) {
      transform: rotate(-45deg) translate(5px, -5px);
    }

    /* Donate link inside UL: hidden on desktop */
    .nav-links a.donate-mobile {
      display: none;
    }

    /* ───────────────────────────────────────────────
       RUNES + ALIGNMENT FIX (TOP-LEVEL ONLY)
       ───────────────────────────────────────────── */
    .navbar .nav-links>li.dropdown {
      --badge-space: 52px;
      position: relative;
    }

    .navbar .nav-links>li.dropdown>a,
    .navbar .nav-links>li.dropdown>button {
      position: relative;
      display: inline-flex;
      align-items: center;
      min-height: 42px;
      padding-left: var(--badge-space);
    }

    .navbar .nav-links>li.dropdown>.dropdown-content {
      left: var(--badge-space);
    }

    .navbar .nav-links>li.dropdown::before {
      content: "ᚠ";
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      --rune-blue: #2ee6ff;
      color: var(--rune-blue);
      background: rgba(46, 230, 255, .08);
      border: 1px solid rgba(46, 230, 255, .6);
      box-shadow: 0 0 10px rgba(46, 230, 255, .45), 0 0 18px rgba(46, 230, 255, .25) inset;
      text-shadow: 0 0 2px rgba(46, 230, 255, .85), 0 0 6px rgba(46, 230, 255, .65);
      font-size: 1rem;
      line-height: 1;
      font-weight: 700;
    }

    .navbar .nav-links>li.dropdown:hover::before {
      box-shadow: 0 0 12px rgba(46, 230, 255, .55), 0 0 22px rgba(46, 230, 255, .30) inset;
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+1)::before {
      content: "ᚠ";
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+2)::before {
      content: "ᚢ";
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+3)::before {
      content: "ᚦ";
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+4)::before {
      content: "ᚨ";
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+5)::before {
      content: "ᚱ";
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+6)::before {
      content: "ᚲ";
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+7)::before {
      content: "ᚷ";
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+8)::before {
      content: "ᚹ";
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+9)::before {
      content: "ᚺ";
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+10)::before {
      content: "ᚾ";
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+11)::before {
      content: "ᛃ";
    }

    .navbar .nav-links>li.dropdown:nth-child(12n+12)::before {
      content: "ᛉ";
    }

    .navbar .dropdown-content li::before,
    .navbar .dropdown-submenu li::before {
      content: none !important;
      display: none !important;
    }

    .navbar .dropdown-content a,
    .navbar .dropdown-content button,
    .navbar .dropdown-submenu a,
    .navbar .dropdown-submenu button {
      padding-left: var(--submenu-pad-x);
    }

    /* Highlight current page link */
    .nav-links a.active,
    .nav-links button.active {
      color: var(--sb-gold-strong);
      /* brighter color */
      font-weight: 700;
      /* bolder text */
      border-left: 3px solid var(--sb-gold-strong);
      /* subtle marker */
      padding-left: calc(20px - 3px);
      /* keep alignment with marker */
      background-color: rgba(255, 255, 255, 0.05);
      /* faint background */
    }

    /* ─────────────────────────────────────────────
       RESPONSIVE
       ───────────────────────────────────────────── */
    @media (max-width:980px) {
      .hamburger {
        display: flex;
      }

      .nav-links {
        position: absolute;
        top: 80px;
        left: 0;
        right: 0;
        background: rgba(23, 25, 34, .96);
        flex-direction: column;
        display: none;
        padding: 20px 0;
        border-bottom: 1px solid var(--sb-border);
      }

      .nav-links.active {
        display: flex;
      }

      .nav-links>li {
        width: 100%;
        text-align: left;
        margin: 10px 0;
      }

      .nav-links>li>a,
      .nav-links>li>button {
        padding: 10px 20px;
        line-height: normal;
        border-radius: 6px;
        margin: 0 12px;
      }

      /* nested panels become static on mobile */
      .dropdown-content,
      .dropdown-submenu {
        position: static;
        background: none;
        border: 0;
        box-shadow: none;
        width: auto;
        padding: 0;
      }

      .nav-toggle[aria-expanded="true"]+ul {
        opacity: 1;
        max-height: 1000px;
        /* large enough to fit contents */
      }

      .dropdown-content a,
      .dropdown-content button,
      .dropdown-submenu a,
      .dropdown-submenu button {
        padding: 10px 28px !important;
        font-size: 1.1rem;
        border-radius: 6px;
        white-space: normal;
      }

      /* hide desktop donate; show mobile donate */
      .nav-actions>a {
        display: none;
      }

      .nav-links a.donate-mobile {
        display: flex;
        justify-content: center;
        background: var(--sb-gold);
        color: #1a1208;
        padding: 12px 0;
        border-radius: 8px;
        text-decoration: none;
        font-size: 1.1rem;
        margin: 8px 12px 0;
      }

      .nav-links a.donate-mobile:hover {
        background: var(--sb-gold-strong);
      }

      .nav-links a:active,
      .nav-links button:active {
        background-color: rgba(255, 255, 255, 0.08);
      }

      /* MOBILE: remove rune badges + reset offset */
      .navbar .nav-links>li.dropdown::before {
        content: none !important;
        display: none !important;
      }

      .navbar .nav-links>li.dropdown>a,
      .navbar .nav-links>li.dropdown>button {
        padding-left: 20px !important;
      }

      .navbar .nav-links>li.dropdown>.dropdown-content {
        left: 0;
        padding-left: 0;
        margin-left: 0;
      }

      /* ── MOBILE ONLY ADJUSTMENTS ───────────────────────── */

      /* Make top-level headers (the main buttons) slightly bluer for hierarchy */
      .nav-links>li.dropdown>.nav-toggle {
        /* soft blue variant of your dim text */
        color: #bcd7e5;
        /* tweak this hex if you want it more/less blue */
        font-weight: 600;
      }

      /* Slightly increase left padding for submenu items (level-1) */
      .dropdown-content>li>a,
      .dropdown-content>li>button {
        padding-left: 36px !important;
        /* was ~28px */
      }

      /* Indent level-2 items even more */
      .dropdown-submenu>li>a,
      .dropdown-submenu>li>button {
        padding-left: 56px !important;
      }

      .dropdown-content a,
      .dropdown-content button,
      .dropdown-submenu a,
      .dropdown-submenu button {
        min-height: 44px;
      }
    }

    @media (max-width:480px) {

      .nav-links>li>a,
      .nav-links>li>button {
        font-size: 1rem;
      }
    }

    /* Scroll lock when mobile menu is open */
    html.menu-open,
    html.menu-open body {
      overflow: hidden;
    }
  </style>

  <div class="logo">
    <a href="index.html"><img src="assets/skazka_logo.png" alt="Skazka Logo"></a>
  </div>

  <ul class="nav-links" id="nav-menu" aria-label="Primary">
    <!-- World -->
    <li class="dropdown">
      <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-world">World</button>
      <ul class="dropdown-content" id="submenu-world" hidden>
        <li><a href="overview.html">Overview</a></li>
        <li><a href="multiverse.html">Multiverse</a></li>
        <li><a href="seasons.html">Seasons & Time</a></li>
        <li><a href="maps.html">Maps</a></li>
      </ul>
    </li>

    <!-- Beliefs -->
    <li class="dropdown">
      <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-beliefs">Beliefs</button>
      <ul class="dropdown-content" id="submenu-beliefs" hidden>
        <li><a href="creation.html">Creation</a></li>

        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-vekya">The Vekya</button>
          <ul class="dropdown-submenu" id="submenu-vekya" hidden>
            <li><a href="primordials.html">The Primordials</a></li>
            <li><a href="uzume.html">Uzume</a></li>
            <li><a href="kaos.html">Kaos</a></li>
            <li><a href="Kronos.html">Kronos</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-annarr">The Annarr</button>
          <ul class="dropdown-submenu" id="submenu-annarr" hidden>
            <li><a href="highones.html">The High Ones</a></li>
            <li><a href="frur.html">Frur</a></li>
            <li><a href="skald.html">Skald</a></li>
            <li><a href="aeter.html">Aeter</a></li>
            <li><a href="njord.html">Njord</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-prir">The Prir</button>
          <ul class="dropdown-submenu" id="submenu-prir" hidden>
            <li><a href="walkinggods.html">The Walking Gods</a></li>
            <li><a href="chernabog.html">Chernabog</a></li>
            <li><a href="herukan.html">Herukan</a></li>
            <li><a href="mortifer.html">Mortifer</a></li>
            <li><a href="agos.html">Agos</a></li>
            <li><a href="silithus.html">Silithus</a></li>
            <li><a href="leonarah.html">Leonarah</a></li>
            <li><a href="surrana.html">Surrana</a></li>
            <li><a href="cormarin.html">Cormarin</a></li>
            <li><a href="sylka.html">Sylka</a></li>
            <li><a href="than.html">Than</a></li>
            <li><a href="ioun.html">Ioun</a></li>
            <li><a href="lunica.html">Lunica</a></li>
            <li><a href="mani.html">Mani</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-lesser">Lesser Powers</button>
          <ul class="dropdown-submenu" id="submenu-lesser" hidden>
            <li><a href="lesserpowers.html">Lesser powers</a></li>
            <li><a href="fafnirog.html">Fafnirog</a></li>
            <li><a href="hags.html">The Hags</a></li>
            <li><a href="lolth.html">Lolth</a></li>
            <li><a href="jutus.html">Jutus</a></li>
            <li><a href="hunt.html">The Wild Hunt</a></li>
            <li><a href="agramaul.html">Agramaul</a></li>
            <li><a href="Koshchei.html">Koshchei</a></li>
          </ul>
        </li>
      </ul>
    </li>

    <!-- People -->
    <li class="dropdown">
      <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-people">People</button>
      <ul class="dropdown-content" id="submenu-people" hidden>
        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-races">Races</button>
          <ul class="dropdown-submenu" id="submenu-races" hidden>
            <li><a href="dragonborn.html">Dragonborn</a></li>
            <li><a href="dwarves.html">Dwarves</a></li>
            <li><a href="elves.html">Elves</a></li>
            <li><a href="gnomes.html">Gnomes</a></li>
            <li><a href="orcs.html">Orcs</a></li>
            <li><a href="humans.html">Humans</a></li>
            <li><a href="beastraces.html">The Beast Races</a></li>
            <li><a href="bsgoblins.html">Blacksong Goblins</a></li>
          </ul>
        </li>
        <li><a href="heroes.html">Heroes & Villains</a></li>
      </ul>
    </li>

    <!-- Places -->
    <li class="dropdown">
      <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-places">Places</button>
      <ul class="dropdown-content" id="submenu-places" hidden>
        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-nations">Nations & States</button>
          <ul class="dropdown-submenu" id="submenu-nations" hidden>
            <li><a href="aeternia.html">Aeternia</a></li>
            <li><a href="caratania.html">Caratania</a></li>
            <li><a href="oldkaijistan.html">Old Kaijistan</a></li>
            <li><a href="serydina.html">Serydina</a></li>
            <li><a href="dargav.html">Necropolis of Dargav</a></li>
            <li><a href="kuthan.html">Ku'than</a></li>
            <li><a href="winter.html">Winter</a></li>
            <li><a href="Excitavitsene.html">Excitavitsene</a></li>
            <li><a href="navgolam.html">Nav'golam</a></li>
            <li><a href="everdusk.html">Everdusk</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-ruins">Ruins</button>
          <ul class="dropdown-submenu" id="submenu-ruins" hidden>
            <li><a href="orishan.html">Orishan</a></li>
            <li><a href="kitezh.html">Kitezh</a></li>
            <li><a href="velkaria.html">Velkaria</a></li>
            <li><a href="grimspire_ruins.html">Grimspire</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-landmarks">Landmarks</button>
          <ul class="dropdown-submenu" id="submenu-landmarks" hidden>
            <li><a href="ZhalShaar.html">Zhal'Shaar</a></li>
            <li><a href="glassdunes.html">The Glass Dunes</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-realms">Strange Realms</button>
          <ul class="dropdown-submenu" id="submenu-realms" hidden>
            <li><a href="rusalka.html">Rusalka</a></li>
            <li><a href="cerv.html">The Cerv Dominion</a></li>
          </ul>
        </li>
      </ul>
    </li>

    <!-- Groups -->
    <li class="dropdown">
      <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-groups"
        aria-haspopup="true">Groups</button>
      <ul class="dropdown-content" id="submenu-groups">
        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-cults"
            aria-haspopup="true">Cults</button>
          <ul class="dropdown-submenu" id="submenu-cults">
            <li><a href="#">The Black Coin Society</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-guilds"
            aria-haspopup="true">Guilds</button>
          <ul class="dropdown-submenu" id="submenu-guilds">
            <li><a href="#">Guild Example</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-societies"
            aria-haspopup="true">Societies</button>
          <ul class="dropdown-submenu" id="submenu-societies">
            <li><a href="#">Society Example</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-academia"
            aria-haspopup="true">Academia</button>
          <ul class="dropdown-submenu" id="submenu-academia">
            <li><a href="#">Order of the Word</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-trade" aria-haspopup="true">Trade
            &amp; Alliances</button>
          <ul class="dropdown-submenu" id="submenu-trade">
            <!-- empty for now -->
          </ul>
        </li>
        <li class="dropdown">
          <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-military"
            aria-haspopup="true">Military</button>
          <ul class="dropdown-submenu" id="submenu-military">
            <li><a href="#">The Shield of Dawn</a></li>
          </ul>
        </li>
      </ul>
    </li>


    <!-- History -->
    <li class="dropdown">
      <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-history">History</button>
      <ul class="dropdown-content" id="submenu-history" hidden>
        <li><a href="events.html">Events</a></li>
        <li><a href="timeline.html">Timeline</a></li>
      </ul>
    </li>

    <!-- Things -->
    <li class="dropdown">
      <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-things">Things</button>
      <ul class="dropdown-content" id="submenu-things" hidden>
        <li><a href="artefacts.html">Artefacts</a></li>
        <li><a href="materials.html">Materials</a></li>
        <li><a href="bestiary.html">Bestiary</a></li>
      </ul>
    </li>

    <!-- Players -->
    <li class="dropdown">
      <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-players">Players</button>
      <ul class="dropdown-content" id="submenu-players" hidden>
        <li><a href="cc.html">Character creation</a></li>
        <li><a href="options.html">Player options</a></li>
        <li><a href="cast.html">Cast</a></li>
        <li><a href="scores.html">Statistics</a></li>
      </ul>
    </li>

    <!-- Other -->
    <li class="dropdown">
      <button class="nav-toggle" aria-expanded="false" aria-controls="submenu-other">Other</button>
      <ul class="dropdown-content" id="submenu-other" hidden>
        <li><a href="#">Bestiary</a></li>
        <li><a href="insignia.html">Insignia</a></li>
        <li><a href="dice.html">Dice Roller</a></li>
        <li><a href="monster-builder.html">Monster builder</a></li>
        <li><a href="tables.html">Generators & Tables</a></li>
      </ul>
    </li>

    <!-- stand alone search -->
    <li class="dropdown"><a href="glossary-search.html">Search</a></li>

    <!-- Mobile donate (hidden on desktop) -->
    <li><a href="https://buy.stripe.com/aFabJ10kD8BN8kL8mm1ZS03" target="_blank" class="donate-mobile">Donate</a></li>
  </ul>

  <div class="nav-actions">
    <a href="https://buy.stripe.com/aFabJ10kD8BN8kL8mm1ZS03" target="_blank">
      <button class="donate">Donate</button>
    </a>
    <div class="hamburger" role="button" aria-label="Toggle menu" aria-expanded="false" tabindex="0" id="hamburger">
      <span></span><span></span><span></span>
    </div>
  </div>

  <script>
    (function () {
      const mqMobile = () => window.matchMedia('(max-width:980px)').matches;
      const html = document.documentElement;
      const burger = document.getElementById('hamburger');
      const menu = document.getElementById('nav-menu');

      function openMenu() {
        menu.classList.add('active');
        burger.classList.add('open');
        burger.setAttribute('aria-expanded', 'true');
        html.classList.add('menu-open'); // scroll lock
      }
      function closeMenu() {
        menu.classList.remove('active');
        burger.classList.remove('open');
        burger.setAttribute('aria-expanded', 'false');
        html.classList.remove('menu-open');
      }

      // Burger click & keyboard
      burger.addEventListener('click', () => {
        const isOpen = burger.classList.contains('open');
        isOpen ? closeMenu() : openMenu();
      });
      burger.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); burger.click(); }
      });

      // Prevent navigation on placeholder anchors (#) anywhere in menu
      menu.addEventListener('click', (e) => {
        const a = e.target.closest('a[href="#"]');
        if (a) {
          e.preventDefault();
          // Don't close the menu for placeholders
        }
      });

      // Mobile-only submenu toggles (buttons with aria-controls)
      menu.addEventListener('click', (e) => {
        const btn = e.target.closest('.nav-toggle');
        if (!btn) return;
        if (!mqMobile()) return; // desktop uses hover/focus CSS
        const id = btn.getAttribute('aria-controls');
        const panel = id && document.getElementById(id);
        if (!panel) return;

        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        panel.hidden = expanded;
        e.stopPropagation();
      });

      // Close menu on real navigation (mobile)
      menu.addEventListener('click', (e) => {
        if (!mqMobile()) return;
        const link = e.target.closest('a[href]');
        if (!link) return;
        const href = link.getAttribute('href') || '';
        if (href === '#' || href.startsWith('#')) {
          // hash or placeholder → stay open
          e.preventDefault();
          return;
        }
        // real navigation → close
        closeMenu();
      });

      // Collapse all submenus when leaving mobile
      const resetSubmenus = () => {
        if (!mqMobile()) {
          // ensure hidden attribute doesn't interfere on desktop
          document.querySelectorAll('#nav-menu .dropdown-content,[id^="submenu-"]').forEach(p => p.hidden = false);
          document.querySelectorAll('#nav-menu .nav-toggle').forEach(b => b.setAttribute('aria-expanded', 'false'));
        } else {
          // start collapsed on mobile
          document.querySelectorAll('#nav-menu .dropdown-content,[id^="submenu-"]').forEach(p => p.hidden = true);
          document.querySelectorAll('#nav-menu .nav-toggle').forEach(b => b.setAttribute('aria-expanded', 'false'));
        }
      };
      window.addEventListener('resize', resetSubmenus);
      // initial
      resetSubmenus();

      // Close menu on Escape (mobile)
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && mqMobile()) closeMenu();
      });

      // Click outside to close (mobile)
      document.addEventListener('click', (e) => {
        if (!mqMobile()) return;
        if (!menu.classList.contains('active')) return;
        const inside = e.target.closest('.navbar');
        if (!inside) closeMenu();
      });
    })();
  </script>
</nav>